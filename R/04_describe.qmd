---
title: "04_describe"
format: html
editor: visual
---

```{r}
#| message: false
library(tidyverse)
library(table1)
library(patchwork)
library(ggplot2)
library(dplyr)
library(gt)
library(gridExtra)
```

## Description

```{r}
# Number of rows and columns in the dataset 
print(nrow(merged_data))
print(ncol(merged_data))
```

## Creating a summary table

```{r}
# Making a summary table
summary_table_merged_data <- merged_data |> 
  group_by(status) |> 
  summarise(
    `count` = n(),
    `Age in years median (range)` = paste0(median(age_years),                                  # Calculating the median and range of age
                                            " (", min(age_years),
                                            "-", max(age_years), 
                                            ")"),
    `Maternal BMI mean (range)` = paste0(round(mean(maternal_bmi), 1),                         # Calculating the median and range of BMI
                                           " (", min(maternal_bmi), 
                                           "-", max(maternal_bmi), 
                                           ")"),
    `Parity mean` = paste0(round(mean(parity), 1)),                                            # Calculating the mean of parity
    `Gestational Age in weeks median (range)` = paste0(median(gestational_age_weeks),          # Calculating the mean and range of GA
                                                        " (", min(gestational_age_weeks),     
                                                        "-", max(gestational_age_weeks), 
                                                        ")")
  )
# Transposing the table
summary_table <- t(summary_table_merged_data)
print(summary_table)

# Now we want to count how many genes there are, and add this to the table
summary_table <- merged_data |>
  mutate("Number of genes" = select(starts_with("ilmn")) |> #Selecting all columns that start with "ILMN"
  ncol()

print(summary_table)
```

```{r}
bp_age <- merged_data |>
  ggplot(aes(x = status, y = age_years, fill = status)) +
  geom_boxplot() +
  labs(
    x = "Status",
    y = "Age (years)",
    title = "Boxplot of Age by Smoking Status"
  ) +
  scale_fill_manual(
      values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
    ) +
  theme(
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white"),
      panel.grid.major = element_line(color = "gray90"),
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 5, color = "black"),
      axis.title = element_text(size = 7, color = "black"),
      plot.title = element_text(size = 7
                                , face = "bold", color = "black"))

ggsave("../results/plots/description_age_boxplot.png")


```

```{r}
bp_maternal_bmi <- merged_data |>
  ggplot(aes(x = status, y = maternal_bmi, fill = status)) +
  geom_boxplot() +
  labs(
    x = "Status",
    y = "Maternal BMI",
    title = "Boxplot of Maternal BMI by Smoking Status"
  ) +
  scale_fill_manual(
      values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
    ) +
  theme(
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white"),
      panel.grid.major = element_line(color = "gray90"),
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 5, color = "black"),
      axis.title = element_text(size = 7, color = "black"),
      plot.title = element_text(size = 7, face = "bold", color = "black"))

ggsave("../results/plots/description_maternal_bmi_boxplot.png")

  
```

```{r}
bp_placental_volume <- merged_data |>
  ggplot(aes(x = status, y = placental_volume_cm3, fill = status)) +
  geom_boxplot() +
  labs(
    x = "Status",
    y = "Placental volume in cm3",
    title = "Boxplot of Placental Volume by Smoking Status"
  ) +
  scale_fill_manual(
    values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
  ) +
  theme(
    panel.background = element_rect(fill = "white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank(),
    axis.text = element_text(size = 5, color = "black"),
    axis.title = element_text(size = 7, color = "black"),
    plot.title = element_text(size = 7, face = "bold", color = "black"))

ggsave("../results/plots/description_placental_volume_boxplot.png")

```

```{r}
(bp_placental_volume + theme(legend.position = "none") + 
     (bp_maternal_bmi + theme(legend.position = "none")
      )) / bp_age + 
     
     plot_annotation(title = "Comparison by Smoking Status",
                     caption = "Data from NCBI (2009)",
                     theme = theme(legend.position = "topright",
                                   plot.title = element_text(size = 10,
                                                             hjust = 0.5, 
                                                             face = "bold", 
                                                             margin = margin(0,0,0,0),
                                                             color = "black"),
                                   plot.margin=grid::unit(c(t = 0, r = 0, b = 0, l = -1.3), "mm"))) +
  plot_layout(guides = "collect", heights = unit(c(1.35, 2.35), c('cm', 'cm')))
ggsave("../results/plots/description_combined_plot1.png")
combined_plot1

```

```{r}

# Subset numeric columns (e.g., ilmn columns)
gene_data <- merged_data |>
  select(starts_with("ilmn_"))

heatmap(as.matrix(gene_data), scale = "row", 
        main = "Heatmap of Gene Expression")

```

```{r}
ggplot(merged_data, aes(x = mode_of_delivery, y = maternal_bmi, fill = mode_of_delivery)) +
  geom_violin(trim = FALSE) +
  labs(title = "Maternal BMI by Mode of Delivery", x = "Mode of Delivery", y = "Maternal BMI") +
  theme_minimal()
```

## Correlation between BMI_class and smokers

```{r}
bp_bmi_classs_status <- merged_data |>
  ggplot(aes(x = bmi_class, fill = status)) +
  geom_bar() +
  labs(
    x = "BMI Class",
    y = "Count ",
    title = "Relationship between BMI Class and Status"
  ) +
  scale_fill_manual(
      values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
    ) +
  theme(
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white"),
      panel.grid.major = element_line(color = "gray90"),
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 5, color = "black"),
      axis.title = element_text(size = 7, color = "black"),
      plot.title = element_text(size = 7, face = "bold", color = "black"))

ggsave("../results/plots/description_bmi_class_boxplot.png")

print(bp_bmi_classs_status)
```
