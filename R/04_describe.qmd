---
title: "Description of Dataset"
format: html
editor: visual
---

```{r}
#| message: false
library(tidyverse)
library(table1)
library(patchwork)
library(ggplot2)
library(dplyr)
```

## Description

```{r}
# Rows and columns in the last 
print(nrow(merged_data))
print(ncol(merged_data))
merged_data |> sample_n(5)


```

```{r}
library(dplyr)
library(tidyr)
library(gt)
library(gridExtra)


# Percentages of non_smoker, smoker and overall in the different categories
label(merged_data$age_years) <- "Age (Years)"
label(merged_data$maternal_bmi) <- "Maternal BMI"
label(merged_data$gestational_age_weeks) <- "Gestational Age (Weeks)"
label(merged_data$placental_volume_cm3) <- "Placental Volume (cmÂ³)"

# Generate the table with customized labels
merged_data |>
  slice_head(n = num_mothers) |>
  table1(
    x = formula(~ age_years + maternal_bmi + gestational_age_weeks + placental_volume_cm3 | status),
    data = _
  )


```

```{r}

bp_age <- merged_data |>
  ggplot(aes(x = status, y = age_years, fill = status)) +
  geom_boxplot() +
  labs(
    x = "Status",
    y = "Age (years)",
    title = "Boxplot of Age by Smoking Status"
  ) +
  scale_fill_manual(
      values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
    ) +
  theme(
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white"),
      panel.grid.major = element_line(color = "gray90"),
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 5, color = "black"),
      axis.title = element_text(size = 7, color = "black"),
      plot.title = element_text(size = 7
                                , face = "bold", color = "black"))

ggsave("../results/plots/description_age_boxplot.png")


```

```{r}
bp_maternal_bmi <- merged_data |>
  ggplot(aes(x = status, y = maternal_bmi, fill = status)) +
  geom_boxplot() +
  labs(
    x = "Status",
    y = "Maternal BMI",
    title = "Boxplot of Maternal BMI by Smoking Status"
  ) +
  scale_fill_manual(
      values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
    ) +
  theme(
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white"),
      panel.grid.major = element_line(color = "gray90"),
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 5, color = "black"),
      axis.title = element_text(size = 7, color = "black"),
      plot.title = element_text(size = 7, face = "bold", color = "black"))

ggsave("../results/plots/description_maternal_bmi_boxplot.png")

  
```

```{r}
bp_placental_volume <- merged_data |>
  ggplot(aes(x = status, y = placental_volume_cm3, fill = status)) +
  geom_boxplot() +
  labs(
    x = "Status",
    y = "Placental volume in cm3",
    title = "Boxplot of Placental Volume by Smoking Status"
  ) +
  scale_fill_manual(
    values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
  ) +
  theme(
    panel.background = element_rect(fill = "white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank(),
    axis.text = element_text(size = 5, color = "black"),
    axis.title = element_text(size = 7, color = "black"),
    plot.title = element_text(size = 7, face = "bold", color = "black"))

ggsave("../results/plots/description_placental_volume_boxplot.png")

```

```{r}
bp_gestational_age <- merged_data |>
  ggplot(aes(x = status, y = gestational_age_weeks, fill = status)) +
  geom_boxplot() +
  labs(
    x = "Status",
    y = "Gestational age (weeks)",
    title = "Boxplot of Gestational Age by Smoking Status"
  ) +
  scale_fill_manual(
      values = c("non-smoker" = "#F9A1A1", "smoker" = "#63B8B8")
    ) +
  theme(
      panel.background = element_rect(fill = "white"),
      plot.background = element_rect(fill = "white"),
      panel.grid.major = element_line(color = "gray90"),
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 5, color = "black"),
      axis.title = element_text(size = 7, color = "black"),
      plot.title = element_text(size = 7, face = "bold", color = "black"))

ggsave("../results/plots/description_gestational_age_boxplot.png")

```

```{r}
ggplot(merged_data, aes(x = as.factor(parity), y = age_years)) +
  geom_boxplot(fill = "#63B8B8") +
  labs(
    title = "Age Distribution by Parity",
    x = "Parity (Number of Children)",
    y = "Age (Years)"
  ) +
  theme_minimal()


ggsave("../results/plots/description_parity_age_boxplot.png")
```

```{r}
(bp_placental_volume + theme(legend.position = "none") + 
     (bp_maternal_bmi + theme(legend.position = "none")
      )) / bp_age + 
     
     plot_annotation(title = "Comparison by Smoking Status",
                     caption = "Data from NCBI (2009)",
                     theme = theme(legend.position = "topright",
                                   plot.title = element_text(size = 10,
                                                             hjust = 0.5, 
                                                             face = "bold", 
                                                             margin = margin(0,0,0,0),
                                                             color = "black"),
                                   plot.margin=grid::unit(c(t = 0, r = 0, b = 0, l = -1.3), "mm"))) +
  plot_layout(guides = "collect", heights = unit(c(1.35, 2.35), c('cm', 'cm')))
ggsave("../results/plots/description_combined_plot1.png")
combined_plot1

```

```{r}

# Subset numeric columns (e.g., ilmn columns)
gene_data <- merged_data |>
  select(starts_with("ilmn_"))

heatmap(as.matrix(gene_data), scale = "row", 
        main = "Heatmap of Gene Expression")

```

```{r}
ggplot(merged_data, aes(x = mode_of_delivery, y = maternal_bmi, fill = mode_of_delivery)) +
  geom_violin(trim = FALSE) +
  labs(title = "Maternal BMI by Mode of Delivery", x = "Mode of Delivery", y = "Maternal BMI") +
  theme_minimal()

```

```{r}

```
