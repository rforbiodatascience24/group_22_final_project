# Ensure status is a factor
```{r}
library(ggplot2)

ggplot(merged_data, aes(x = gestational_age_weeks, y = placental_volume_cm3, color = status)) +
  geom_point(alpha = 0.6, size = 3) +
  labs(
    title = "Placental Volume vs. Gestational Age",
    x = "Gestational Age (weeks)",
    y = "Placental Volume (cmÂ³)",
    color = "Smoking Status"
  ) +
  theme_minimal()

```
# Plot volcano plot
```{r}
ggplot(merged_log2_fold, aes(x = log2_fold_change)) +
  geom_histogram(binwidth = 0.2, fill = "blue", alpha = 0.7, color = "black") +
  labs(
    title = "Distribution of Log2 Fold-Change",
    x = "Log2 Fold Change",
    y = "Frequency"
  ) +
  theme_minimal()


```



```{r}
library(corrplot)

# Compute correlation matrix for gene columns
gene_data <- merged_data %>% 
  select(starts_with("ilmn"))

correlation_matrix <- cor(gene_data, use = "complete.obs")

# Generate a correlation heatmap
corrplot(correlation_matrix, method = "circle", tl.cex = 0.6, main = "Correlation Matrix of Gene Expression")

```

```{r}
merged_log2_fold <- merged_log2_fold |> 
  mutate(mean_expression = (`smoker` + `non-smoker`) / 2)

ggplot(merged_log2_fold, aes(x = mean_expression, y = log2_fold_change)) +
  geom_point(aes(color = p_value < 0.05), alpha = 0.6) +
  scale_color_manual(values = c("grey", "red"), labels = c("Not Significant", "Significant")) +
  labs(
    title = "Log2 Fold-Change vs. Mean Expression",
    x = "Mean Expression",
    y = "Log2 Fold Change",
    color = "Significance"
  ) +
  theme_minimal()
```
```{r}
library(dplyr)

# Extract top 10 genes with the smallest p-values
top_genes <- merged_log2_fold |> 
  arrange(p_value) |> 
  slice_head(n = 10)

print(top_genes)

# Optional: Plot top genes' log2 fold-change
ggplot(top_genes, aes(x = reorder(gene, log2_fold_change), y = log2_fold_change, fill = p_value < 0.05)) +
  geom_bar(stat = "identity", alpha = 0.7) +
  scale_fill_manual(values = c("grey", "red")) +
  coord_flip() +
  labs(
    title = "Top 10 Genes by Log2 Fold Change",
    x = "Gene",
    y = "Log2 Fold Change",
    fill = "Significance"
  ) +
  theme_minimal()
```
